# Deploying a secure web application in production with


```terminal

  ██╗     ███████╗████████╗███████╗    ███████╗███╗   ██╗ ██████╗██████╗ ██╗   ██╗██████╗ ████████╗
  ██║     ██╔════╝╚══██╔══╝██╔════╝    ██╔════╝████╗  ██║██╔════╝██╔══██╗╚██╗ ██╔╝██╔══██╗╚══██╔══╝
  ██║     █████╗     ██║   ███████╗    █████╗  ██╔██╗ ██║██║     ██████╔╝ ╚████╔╝ ██████╔╝   ██║   
  ██║     ██╔══╝     ██║   ╚════██║    ██╔══╝  ██║╚██╗██║██║     ██╔══██╗  ╚██╔╝  ██╔═══╝    ██║   
  ███████╗███████╗   ██║   ███████║    ███████╗██║ ╚████║╚██████╗██║  ██║   ██║   ██║        ██║   
  ╚══════╝╚══════╝   ╚═╝   ╚══════╝    ╚══════╝╚═╝  ╚═══╝ ╚═════╝╚═╝  ╚═╝   ╚═╝   ╚═╝        ╚═╝   

                                               ██╗                                                           
                                               ██║                                                           
                                            ████████╗                                                        
                                            ██╔═██╔═╝                                                        
                                            ██████║                                                          
                                            ╚═════╝                                                          

                       ██████╗███████╗██████╗ ████████╗██████╗  ██████╗ ████████╗                              
                      ██╔════╝██╔════╝██╔══██╗╚══██╔══╝██╔══██╗██╔═══██╗╚══██╔══╝                              
                      ██║     █████╗  ██████╔╝   ██║   ██████╔╝██║   ██║   ██║                                 
                      ██║     ██╔══╝  ██╔══██╗   ██║   ██╔══██╗██║   ██║   ██║                                 
                      ╚██████╗███████╗██║  ██║   ██║   ██████╔╝╚██████╔╝   ██║                                 
                       ╚═════╝╚══════╝╚═╝  ╚═╝   ╚═╝   ╚═════╝  ╚═════╝    ╚═╝
```

## Making iptables rules permanent

[Deploying a secure web application in production with Let's Encrypt and Certbot](Readme.md) details a way to deploy an app or service securely. In doing so, it takes advantage of [iptables](https://en.wikipedia.org/wiki/Iptables) rules to intercept traffic on port 80 or 443 and reroute that traffic to the port your app or service is runming on.

## Debian/Ubuntu Based Instructions

1.  Install the `iptables-persistent` package

    Newer \*Nix Distros

    ```bash
    sudo apt install iptables-persistent
    ```

    Older \*Nix Distros

    ```bash
    sudo apt-get install iptables-persistent

    ```
1.  On installation of `iptables-persistent` package, you will be asked to save the current files. Accept **Yes**

1.  Optional: Check your iptables rule file

    ```bash
    cat /etc/iptables/rules.v4
    ```

    It should look like

    ```text
    # Generated by iptables-save v1.6.1 on Fri Aug 20 02:40:14 2021
    *filter
    :INPUT ACCEPT [71277:316681291]
    :FORWARD ACCEPT [0:0]
    :OUTPUT ACCEPT [58801:6540250]
    COMMIT
    # Completed on Fri Aug 20 02:40:14 2021
    # Generated by iptables-save v1.6.1 on Fri Aug 20 02:40:14 2021
    *nat
    :PREROUTING ACCEPT [1:52]
    :INPUT ACCEPT [1636:90337]
    :OUTPUT ACCEPT [613:66497]
    :POSTROUTING ACCEPT [613:66497]
    -A PREROUTING -i eth0 -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 443
    -A PREROUTING -i eth0 -p tcp -m tcp --dport 443 -j REDIRECT --to-ports 3000
    COMMIT
    # Completed on Fri Aug 20 02:40:14 2021
    ```

1.  If you were not given the option to save the iptables rules, do so by running the following commmand

    ```bash
    sudo iptables-save > /etc/iptables/rules.v4
    ```

    If you get a permission denied error, try:

    ```bash
    sudo iptables-save
    ```

## RedHat/CentOS Based Instructions

1.  Save your newly updated iptables rules to a file

    ```bash
    sudo service iptables save
    ```

1.  Restart the service

    ```bash
    sudo service iptables restart
    ```

1.  Make them permanent

    ```bash
    sudo chkconfig iptables on
    ```
